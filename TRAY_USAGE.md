# Tauri 2.0 系统托盘功能使用说明

## 功能概述

本项目已集成系统托盘功能，支持以下特性：

- ✅ 应用最小化到系统托盘
- ✅ 通过托盘图标显示/隐藏应用窗口
- ✅ 托盘右键菜单（显示、隐藏、退出）
- ✅ 关闭窗口时隐藏到托盘而不是退出应用

## 使用方法

### 1. 托盘图标交互

- **左键单击托盘图标**：切换窗口显示/隐藏状态
  - 显示时：窗口会自动置于最前面，不会被其他窗口遮挡
  - 隐藏时：窗口完全隐藏到系统托盘
- **右键单击托盘图标**：显示上下文菜单
  - 显示：显示应用窗口并获得焦点，确保窗口在最前面
  - 隐藏：隐藏应用窗口到托盘
  - 退出：完全退出应用程序

### 2. 窗口行为

- **点击窗口关闭按钮**：窗口会隐藏到托盘，而不是退出应用
- **在应用内点击"最小化到托盘"按钮**：直接隐藏窗口到托盘

### 3. 完全退出应用

要完全退出应用程序，请：

- 右键点击托盘图标，选择"退出"
- 或者使用系统快捷键（如 Alt+F4）

## 技术实现

### Rust 后端 (src-tauri/src/lib.rs)

- 使用 `tauri::tray` 模块创建系统托盘
- 实现托盘菜单和事件处理
- 设置窗口关闭行为为隐藏而非退出
- **窗口置顶逻辑**：
  - 使用 `window.show()` 显示窗口
  - 使用 `window.unminimize()` 取消最小化状态
  - 使用 `window.set_focus()` 获得焦点
  - 临时设置 `window.set_always_on_top(true)` 确保窗口在最前面
  - 100ms 后自动取消置顶状态，避免影响用户正常使用

### 前端 (src/components/TrayControls.tsx)

- 提供用户友好的托盘控制界面
- 包含使用说明和控制按钮

### 配置文件

- `src-tauri/Cargo.toml`：添加了 `tray-icon` 特性
- `src-tauri/tauri.conf.json`：移除了 `trayIcon` 配置以避免重复创建托盘图标

## 开发和构建

```bash
# 开发模式
pnpm tauri dev

# 构建应用
pnpm tauri build
```

## 注意事项

1. **避免重复托盘图标**：不要在 `tauri.conf.json` 中配置 `trayIcon`，否则会与 Rust 代码创建的托盘冲突
2. **图标要求**：托盘图标使用 `src-tauri/icons/icon.ico` 文件
3. **平台兼容性**：系统托盘功能在 Windows、macOS 和 Linux 上都可用
4. **权限**：某些系统可能需要用户授权才能显示托盘图标
5. **用户体验**：首次使用时建议向用户说明托盘功能的存在

## 自定义

如需自定义托盘功能，可以修改：

- 托盘菜单项：编辑 `create_tray` 函数中的菜单项
- 托盘图标：替换 `src-tauri/icons/` 目录中的图标文件
- 窗口行为：修改 `window.on_window_event` 回调函数
